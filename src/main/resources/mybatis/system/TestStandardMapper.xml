<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.project.system.standard.mapper.TestStandardMapper">
    
    <resultMap type="TestStandard" id="TestStandardResult">
        <result property="testStandardId"    column="test_standard_id"    />
        <result property="tgsId"    column="tgs_id"    />
        <result property="testBase7"    column="test_base7"    />
        <result property="testBase8"    column="test_base8"    />
        <result property="testBase9"    column="test_base9"    />
        <result property="testPoint"    column="test_point"    />
        <result property="testGradeId"    column="test_grade_id"    />
        <result property="testItemId"    column="test_item_id"    />
        <result property="grade"    column="grade"    />
        <result property="stuSexId"    column="stu_sex_id"    />
        <result property="testItemName"    column="test_item_name"    />

    </resultMap>

    <sql id="selectTestStandardVo">
        SELECT
            ts.test_point,
            ts.test_grade_id,
            ts.test_standard_id,
            sr.stu_sex_id,
            ti.test_item_name,
            MAX(CASE WHEN grade=7 THEN test_base END ) AS test_base7,
            MAX(CASE WHEN grade=8 THEN test_base END ) AS test_base8,
            MAX(CASE WHEN grade=9 THEN test_base END ) AS test_base9

        FROM test_standard ts,test_grade_sex_relation sr,test_item ti
        WHERE ti.test_item_id=sr.test_item_id
          AND ts.tgs_id=sr.tgs_id
        AND sr.test_item_id=2 AND stu_sex_id=0
        GROUP BY test_point
        ORDER BY test_base8

    </sql>

    <sql id="selectTestStandardVoid">
        SELECT


            ts.test_point,
            ts.test_grade_id,

            sr.stu_sex_id,
            ti.test_item_name,
            MAX(CASE WHEN grade=7 THEN test_base END ) AS test_base7,
            MAX(CASE WHEN grade=8 THEN test_base END ) AS test_base8,
            MAX(CASE WHEN grade=9 THEN test_base END ) AS test_base9

        FROM test_standard ts,test_grade_sex_relation sr,test_item ti
        WHERE ti.test_item_id=sr.test_item_id
          AND ts.tgs_id=sr.tgs_id
          AND stu_sex_id=0
          AND ti.test_item_name like "50米跑"

        GROUP BY test_point
        ORDER BY test_base8


    </sql>

    <select id="selectTestStandardList" parameterType="TestStandard" resultMap="TestStandardResult">

        select
        ts.test_point,
        ts.test_grade_id,

        sr.stu_sex_id,
        ti.test_item_name,
        MAX(CASE WHEN grade=7 THEN test_base END ) AS test_base7,
        MAX(CASE WHEN grade=8 THEN test_base END ) AS test_base8,
        MAX(CASE WHEN grade=9 THEN test_base END ) AS test_base9

        FROM test_standard ts,test_grade_sex_relation sr,test_item ti
        WHERE ti.test_item_id=sr.test_item_id
        AND ts.tgs_id=sr.tgs_id

        <if test="stuSexId != null  and stuSexId != ''"> and stu_sex_id = #{stuSexId}</if>
        <if test="testItemName != null  and testItemName != ''"> and ti.test_item_name like concat('%', #{testItemName}, '%')</if>
        GROUP BY test_point
        ORDER BY test_base8


    </select>
    
    <select id="selectTestStandardById" parameterType="String" resultMap="TestStandardResult">

        SELECT
         ts.test_point,
        ts.test_grade_id,

        sr.stu_sex_id,
        ti.test_item_name,
        MAX(CASE WHEN grade=7 THEN test_base END ) AS test_base7,
        MAX(CASE WHEN grade=8 THEN test_base END ) AS test_base8,
        MAX(CASE WHEN grade=9 THEN test_base END ) AS test_base9

        FROM test_standard ts,test_grade_sex_relation sr,test_item ti
        WHERE ti.test_item_id=sr.test_item_id
        AND ts.tgs_id=sr.tgs_id
#         AND stu_sex_id=0
#         AND ti.test_item_name like "50米跑"
        AND test_point = #{testPoint}

        GROUP BY test_point
        ORDER BY test_base8

    </select>
        
    <insert id="insertTestStandard" parameterType="TestStandard" useGeneratedKeys="true" keyProperty="testStandardId">
        insert into test_standard
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="tgsId != null">ts.tgs_id,</if>
            <if test="testBase != null">test_base,</if>
            <if test="testPoint != null">ts.test_point,</if>
            <if test="testGradeId != null">ts.test_grade_id,</if>

         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="tgsId != null">#{tgsId},</if>
            <if test="testBase != null">#{testBase7},</if>
            <if test="testPoint != null">#{testPoint},</if>
            <if test="testGradeId != null">#{testGradeId},</if>

         </trim>
        <trim prefix=",(" suffix=")" suffixOverrides=",">
            <if test="tgsId != null">#{tgsId},</if>
            <if test="testBase != null">#{testBase8,</if>
            <if test="testPoint != null">#{testPoint},</if>
            <if test="testGradeId != null">#{testGradeId},</if>

        </trim>
        <trim prefix=",(" suffix=")" suffixOverrides=",">
            <if test="tgsId != null">#{tgsId},</if>
            <if test="testBase != null">#{testBase9},</if>
            <if test="testPoint != null">#{testPoint},</if>
            <if test="testGradeId != null">#{testGradeId},</if>

        </trim></insert>

    <update id="updateTestStandard" parameterType="TestStandard">
        update test_standard
        <trim prefix="SET" suffixOverrides=",">
            <if test="tgsId != null">ts.tgs_id = #{tgsId},</if>
            <if test="testBase7 != null">ts.test_base7 = #{testBase7},</if>
            <if test="testBase8 != null">ts.test_base8 = #{testBase8},</if>
            <if test="testBase9 != null">ts.test_base9 = #{testBase9},</if>
            <if test="testPoint != null">ts.test_point = #{testPoint},</if>
            <if test="testGradeId != null">ts.test_grade_id = #{testGradeId},</if>
            <if test="testItemId != null">sr.test_item_id = =#{test_item_id},</if>
            <if test="grade != null">sr.grade =#{grade},</if>
            <if test="stuSexId != null">sr.stu_sex_id =#{stu_sex_id},</if>
            <if test="testItemName != null">ti.test_item_name =#{test_item_name},</if>
        </trim>
        where test_standard_id = #{testStandardId}
    </update>

    <delete id="deleteTestStandardById" parameterType="Long">
        delete from test_standard where test_standard_id = #{testStandardId}
    </delete>

    <delete id="deleteTestStandardByIds" parameterType="String">
        delete from test_standard where test_standard_id in
        <foreach item="testStandardId" collection="array" open="(" separator="," close=")">
            #{testStandardId}
        </foreach>
    </delete>

</mapper>